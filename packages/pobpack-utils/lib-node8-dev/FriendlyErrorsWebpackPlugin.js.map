{"version":3,"sources":["../src/FriendlyErrorsWebpackPlugin.js"],"names":["key","handler","INFO","logger","isSuccessful","messages","errors","length","warnings","FriendlyErrorsWebpackPlugin","constructor","options","Object","assign","context","bundleName","apply","compiler","plugin","info","stats","toJson","success","env","successMessage","console","log","critical","forEach","message"],"mappings":";;;;;;;mEAAA;;AAEA;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,8DAAmB,kCACjB,6CAAY,8BAAZ,CADiB,EAEjB,iDAAgB,+BAAC,8BAAD,CAAhB,CAFiB,CAAnB;;AAKA,4BAAU,EAAEA,KAAK,eAAP,EAAwBC,SAAS,iCAAmB,oBAAOC,IAA1B,CAAjC,EAAV;AACA,MAAMC,SAAS,gCAAW,eAAX,EAA4B,SAA5B,CAAf;AACA,MAAMC,eAAeC,YAAY,CAACA,SAASC,MAAT,CAAgBC,MAAjB,IAA2B,CAACF,SAASG,QAAT,CAAkBD,MAA/E;;IAEqBE,2B,0CACT,8B,0CACI,+BAAG,8BAAH,C,aAFD,MAAkC;;AAI/CC,cAAYC,OAAZ,EAAmC;AAAA;;AAAA;;AAAA,uBAAhB,+BAAG,WAAH,CAAgB;;AAAA;;AACjCC,WAAOC,MAAP,CAAc,IAAd,EAAoBF,OAApB;AACA,SAAKR,MAAL,GAAcA,OAAOW,OAAP,CAAe,EAAEC,YAAYJ,QAAQI,UAAtB,EAAf,CAAd;AACD;;AAEDC,QAAMC,QAAN,EAAgB;AACd;AACAA,aAASC,MAAT,CAAgB,SAAhB,EAA2B,MAAM;AAC/B,WAAKf,MAAL,CAAYgB,IAAZ,CAAiB,cAAjB;AACD,KAFD;;AAIA;AACAF,aAASC,MAAT,CAAgB,MAAhB,EAAwBE,SAAS;AAC/B,YAAMf,WAAW,qCAAsBe,MAAMC,MAAN,KAAiB,IAAjB,CAAtB,CAAjB;;AAEA,UAAIjB,aAAaC,QAAb,CAAJ,EAA4B;AAC1B,aAAKF,MAAL,CAAYmB,OAAZ,CAAoB,wBAApB,EAA8C,EAAEC,KAAK,KAAKA,GAAZ,EAA9C;AACA,YAAI,KAAKC,cAAT,EAAyB;AACvBC,kBAAQC,GAAR,CAAY,KAAKF,cAAjB;AACD;AACD;AACD;;AAED,UAAInB,SAASC,MAAT,CAAgBC,MAApB,EAA4B;AAC1B,aAAKJ,MAAL,CAAYwB,QAAZ,CAAqB,oBAArB;AACAF,gBAAQC,GAAR;AACArB,iBAASC,MAAT,CAAgBsB,OAAhB,CAAwBC,WAAW;AACjCJ,kBAAQC,GAAR,CAAYG,OAAZ;AACAJ,kBAAQC,GAAR;AACD,SAHD;AAIA;AACD;;AAED,UAAIrB,SAASG,QAAT,CAAkBD,MAAtB,EAA8B;AAC5B,aAAKJ,MAAL,CAAYwB,QAAZ,CAAqB,yBAArB;AACAF,gBAAQC,GAAR;AACArB,iBAASG,QAAT,CAAkBoB,OAAlB,CAA0BC,WAAW;AACnCJ,kBAAQC,GAAR,CAAYG,OAAZ;AACAJ,kBAAQC,GAAR;AACD,SAHD;AAID;AACF,KA7BD;AA8BD;AA9C8C,C;;;;;;;kBAA5BjB,2B","file":"FriendlyErrorsWebpackPlugin.js","sourcesContent":["/* eslint-disable no-console */\n\nimport { addConfig, levels } from 'nightingale/src';\nimport Logger from 'nightingale-logger/src';\nimport ConsoleHandler from 'nightingale-console/src';\nimport formatWebpackMessages from 'react-dev-utils/formatWebpackMessages';\n\ntype OptionsType = {|\n  bundleName: string,\n  successMessage: ?string,\n|};\n\naddConfig({ key: 'pobpack-utils', handler: new ConsoleHandler(levels.INFO) });\nconst logger = new Logger('pobpack-utils', 'pobpack');\nconst isSuccessful = messages => !messages.errors.length && !messages.warnings.length;\n\nexport default class FriendlyErrorsWebpackPlugin {\n  bundleName: string;\n  successMessage: ?string;\n\n  constructor(options: ?OptionsType) {\n    Object.assign(this, options);\n    this.logger = logger.context({ bundleName: options.bundleName });\n  }\n\n  apply(compiler) {\n    // webpack is recompiling\n    compiler.plugin('invalid', () => {\n      this.logger.info('Compiling...');\n    });\n\n    // compilation done\n    compiler.plugin('done', stats => {\n      const messages = formatWebpackMessages(stats.toJson({}, true));\n\n      if (isSuccessful(messages)) {\n        this.logger.success('Compiled successfully!', { env: this.env });\n        if (this.successMessage) {\n          console.log(this.successMessage);\n        }\n        return;\n      }\n\n      if (messages.errors.length) {\n        this.logger.critical('Failed to compile.');\n        console.log();\n        messages.errors.forEach(message => {\n          console.log(message);\n          console.log();\n        });\n        return;\n      }\n\n      if (messages.warnings.length) {\n        this.logger.critical('Compiled with warnings.');\n        console.log();\n        messages.warnings.forEach(message => {\n          console.log(message);\n          console.log();\n        });\n      }\n    });\n  }\n}\n"]}