{"version":3,"sources":["../src/createWebpackConfig.js"],"names":["options","env","hmr","production","mainBabelOptions","babelrc","cacheDirectory","presets","require","resolve","babel","target","externals","whitelist","node","__filename","__dirname","cache","performance","hints","resolveLoader","modules","resolveLoaderModules","extensions","mainFields","filter","Boolean","aliasFields","entry","index","join","paths","src","output","path","build","filename","sourceMapFilename","publicPath","libraryTarget","module","rules","parser","requireEnsure","test","loader","exclude","loaders","jsLoaders","moduleRules","plugins","prependPlugins","DefinePlugin","JSON","stringify","SourceMapDevToolPlugin","NoEmitOnErrorsPlugin","HotModuleReplacementPlugin","NamedModulesPlugin","BannerPlugin","banner","raw","entryOnly","include"],"mappings":"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","file":"createWebpackConfig.js","sourcesContent":["// const fs = require('fs');\nimport path from 'path';\nimport webpack from 'webpack';\nimport nodeExternals from 'webpack-node-externals';\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\nimport createOptions, { type OptionsType } from './createOptions';\n\nexport default (options: OptionsType) => {\n  options = createOptions(options);\n  const env = options.env;\n  const hmr = options.hmr;\n  const production = env === 'production';\n\n  const mainBabelOptions = {\n    babelrc: false,\n    cacheDirectory: hmr,\n    presets: [\n      require.resolve('./babel'),\n    ],\n    ...options.babel,\n  };\n\n  return {\n    // Target node\n    target: 'node',\n\n    // don't bundle node_modules dependencies\n    externals: nodeExternals({\n      whitelist: [require.resolve('../hot')],\n    }),\n\n    // __dirname and __filename\n    node: {\n      __filename: true,\n      __dirname: true,\n    },\n\n    // use cache\n    cache: hmr,\n\n    // bundle size is not relevant for node\n    performance: {\n      hints: false,\n    },\n\n    resolveLoader: {\n      modules: options.resolveLoaderModules || ['node_modules'],\n    },\n\n    resolve: {\n      modules: ['node_modules'],\n      extensions: ['.js', '.jsx'],\n      mainFields: [\n        !production && 'webpack:node-dev',\n        'webpack:node',\n        !production && 'webpack:main-dev',\n        'webpack:main',\n        !production && 'main-dev',\n        'main',\n      ].filter(Boolean),\n      aliasFields: [\n        !production && 'webpack:node-aliases-dev',\n        'webpack:node-aliases',\n        'webpack',\n      ].filter(Boolean),\n    },\n\n    entry: {\n      index: [\n        hmr && require.resolve('../hot'),\n        path.join(path.resolve(options.paths.src), options.paths.entry),\n      ].filter(Boolean),\n    },\n\n    output: {\n      path: path.resolve(options.paths.build),\n      filename: '[name].js',\n      sourceMapFilename: '[name].map',\n      publicPath: '/',\n      libraryTarget: 'commonjs2',\n    },\n\n    module: {\n      // force import to be present\n      // strictExportPresence: true,\n\n      rules: [\n        // Disable require.ensure as it's not a standard language feature.\n        { parser: { requireEnsure: false } },\n\n        // json\n        {\n          test: /\\.json$/,\n          loader: 'json-loader',\n        },\n\n        // jsx?\n        {\n          test: /\\.jsx?$/,\n          exclude: [\n            /node_modules/,\n            options.paths.build,\n          ],\n          loaders: [\n            { loader: 'babel-loader', options: mainBabelOptions },\n            ...(options.jsLoaders || []),\n          ],\n        },\n\n        // other rules\n        ...(options.moduleRules || []),\n      ],\n    },\n\n    plugins: [\n      ...(options.prependPlugins || []),\n\n      // enforces the entire path of all required modules match the exact case\n      // of the actual path on disk. Using this plugin helps alleviate cases\n      // for developers working on case insensitive systems like OSX.\n      !production && new CaseSensitivePathsPlugin(),\n\n      new webpack.DefinePlugin({\n        'process.env.NODE_ENV': JSON.stringify(env),\n        ...(production ? { 'module.hot': false } : {}),\n      }),\n\n      // get right stack traces\n      new webpack.SourceMapDevToolPlugin({\n        test: /\\.jsx?$/,\n        filename: '[name].js.map',\n      }),\n\n      new webpack.NoEmitOnErrorsPlugin(),\n\n      hmr && new webpack.HotModuleReplacementPlugin(),\n      hmr && new webpack.NamedModulesPlugin(),\n      hmr && new webpack.BannerPlugin({\n        banner: `require(\"${require.resolve('source-map-support')}\").install({ environment: \"node\" });`,\n        raw: true,\n        entryOnly: false,\n        include: /\\.js$/,\n      }),\n      ...(options.plugins || []),\n    ].filter(Boolean),\n  };\n};\n"]}