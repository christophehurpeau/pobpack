{"version":3,"sources":["../src/createWebpackConfig.js"],"names":["options","env","hmr","production","mainBabelOptions","babelrc","cacheDirectory","presets","require","resolve","babel","target","devtool","externals","whitelist","cache","performance","hints","resolveLoader","modules","extensions","mainFields","filter","Boolean","aliasFields","entry","index","paths","src","output","path","build","filename","sourceMapFilename","publicPath","libraryTarget","module","rules","test","loader","exclude","loaders","jsLoaders","moduleRules","plugins","prependPlugins","DefinePlugin","JSON","stringify","BannerPlugin","raw","banner","NoEmitOnErrorsPlugin","HotModuleReplacementPlugin","NamedModulesPlugin"],"mappings":";;;;;;kQAAA;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe,6BAACA,OAAD,EAA0B;AAAA,UAAzBA,OAAyB;;AACvCA,YAAU,6BAAcA,OAAd,CAAV;AACA,QAAMC,MAAMD,QAAQC,GAApB;AACA,QAAMC,MAAMF,QAAQE,GAApB;AACA,QAAMC,aAAaF,QAAQ,YAA3B;;AAEA,QAAMG;AACJC,aAAS,KADL;AAEJC,oBAAgBJ,GAFZ;AAGJK,aAAS,CACPC,QAAQC,OAAR,CAAgB,SAAhB,CADO;AAHL,KAMDT,QAAQU,KANP,CAAN;;AASA,SAAO;AACL;AACAC,YAAQ,MAFH;AAGL;AACAC,aAAS,YAJJ;AAKL;AACAC,eAAW,oCAAc;AACvBC;AADuB,KAAd,CANN;AASL;AACAC,WAAOb,GAVF;AAWL;AACAc,iBAAa;AACXC,aAAO;AADI,KAZR;AAeLC,mBAAe;AACbC;AADa,KAfV;AAkBLV,aAAS;AACPU,+BADO;AAEPC,iCAFO;AAGPC,kBAAY,CACV,CAAClB,UAAD,IAAe,kBADL,EAEV,cAFU,EAGV,CAACA,UAAD,IAAe,UAHL,EAIV,MAJU,EAKVmB,MALU,CAKHC,OALG,CAHL;AASPC,mBAAa,CACX,CAACrB,UAAD,IAAe,0BADJ,EAEX,sBAFW,EAGX,SAHW,EAIXmB,MAJW,CAIJC,OAJI;AATN,KAlBJ;AAiCLE,WAAO;AACLC,aAAO,CACLxB,OAAO,kBADF,EAEJ,GAAE,eAAKO,OAAL,CAAaT,QAAQ2B,KAAR,CAAcC,GAA3B,CAAgC,WAF9B;AADF,KAjCF;AAuCLC,YAAQ;AACNC,YAAM,eAAKrB,OAAL,CAAaT,QAAQ2B,KAAR,CAAcI,KAA3B,CADA;AAENC,gBAAU,WAFJ;AAGNC,yBAAmB,YAHb;AAINC,kBAAY,GAJN;AAKNC,qBAAe;AALT,KAvCH;;AA+CLC,YAAQ;AACNC,aAAO,CACL;AACEC,cAAM,SADR;AAEEC,gBAAQ;AAFV,OADK,EAKL;AACED,cAAM,aADR;AAEEE,iBAAS,CACP,cADO,EAEPxC,QAAQ2B,KAAR,CAAcI,KAFP,CAFX;AAMEU,iBAAS,CACP,EAAEF,QAAQ,cAAV,EAA0BvC,SAASI,gBAAnC,EADO,EAEP,IAAIJ,QAAQ0C,SAAR,MAAJ,CAFO;AANX,OALK,EAgBL,IAAI1C,QAAQ2C,WAAR,MAAJ,CAhBK;AADD,KA/CH;;AAoELC,aAAS,CACP,IAAI5C,QAAQ6C,cAAR,MAAJ,CADO,EAEP,IAAI,kBAAQC,YAAZ;AACE,8BAAwBC,KAAKC,SAAL,CAAe/C,GAAf;AAD1B,OAEME;AAAA;AAAA,UAFN,EAFO,EAOP,IAAI,kBAAQ8C,YAAZ,CAAyB;AACvBC,WAAK,IADkB;AAEvBC,cAAQ;AAFe,KAAzB,CAPO,EAYP,IAAI,kBAAQC,oBAAZ,EAZO,EAcPlD,OAAO,IAAI,kBAAQmD,0BAAZ,EAdA,EAePnD,OAAO,IAAI,kBAAQoD,kBAAZ,EAfA,EAgBP,IAAItD,QAAQ4C,OAAR,MAAJ,CAhBO,EAiBPtB,MAjBO,CAiBAC,OAjBA;AApEJ,GAAP;AAuFD,C","file":"createWebpackConfig.js","sourcesContent":["// const fs = require('fs');\nimport path from 'path';\nimport webpack from 'webpack';\nimport nodeExternals from 'webpack-node-externals';\nimport createOptions, { type OptionsType } from './createOptions';\n\nexport default (options: OptionsType) => {\n  options = createOptions(options);\n  const env = options.env;\n  const hmr = options.hmr;\n  const production = env === 'production';\n\n  const mainBabelOptions = {\n    babelrc: false,\n    cacheDirectory: hmr,\n    presets: [\n      require.resolve('./babel'),\n    ],\n    ...options.babel,\n  };\n\n  return {\n    // Target node\n    target: 'node',\n    // get right stack traces\n    devtool: 'source-map',\n    // don't bundle node_modules dependencies\n    externals: nodeExternals({\n      whitelist: ['pobpack-node/hot'],\n    }),\n    // use cache\n    cache: hmr,\n    // bundle size is not relevant for node\n    performance: {\n      hints: false,\n    },\n    resolveLoader: {\n      modules: ['node_modules'],\n    },\n    resolve: {\n      modules: ['node_modules'],\n      extensions: ['.js', '.jsx'],\n      mainFields: [\n        !production && 'webpack:main-dev',\n        'webpack:main',\n        !production && 'main-dev',\n        'main',\n      ].filter(Boolean),\n      aliasFields: [\n        !production && 'webpack:node-aliases-dev',\n        'webpack:node-aliases',\n        'webpack',\n      ].filter(Boolean),\n    },\n    entry: {\n      index: [\n        hmr && 'pobpack-node/hot',\n        `${path.resolve(options.paths.src)}/index.js`,\n      ],\n    },\n    output: {\n      path: path.resolve(options.paths.build),\n      filename: '[name].js',\n      sourceMapFilename: '[name].map',\n      publicPath: '/',\n      libraryTarget: 'commonjs2',\n    },\n\n    module: {\n      rules: [\n        {\n          test: /\\.json$/,\n          loader: 'json-loader',\n        },\n        {\n          test: /\\.(js|jsx)$/,\n          exclude: [\n            /node_modules/,\n            options.paths.build,\n          ],\n          loaders: [\n            { loader: 'babel-loader', options: mainBabelOptions },\n            ...(options.jsLoaders || []),\n          ],\n        },\n        ...(options.moduleRules || []),\n      ],\n    },\n\n    plugins: [\n      ...(options.prependPlugins || []),\n      new webpack.DefinePlugin({\n        'process.env.NODE_ENV': JSON.stringify(env),\n        ...(production ? { 'module.hot': false } : {}),\n      }),\n\n      new webpack.BannerPlugin({\n        raw: true,\n        banner: 'require(\"pobpack-node/source-map-support\").install();',\n      }),\n\n      new webpack.NoEmitOnErrorsPlugin(),\n\n      hmr && new webpack.HotModuleReplacementPlugin(),\n      hmr && new webpack.NamedModulesPlugin(),\n      ...(options.plugins || []),\n    ].filter(Boolean),\n  };\n};\n"]}