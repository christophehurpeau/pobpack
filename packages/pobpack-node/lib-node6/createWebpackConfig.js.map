{"version":3,"sources":["../src/createWebpackConfig.js"],"names":["path","require","webpack","nodeExternals","config","options","env","process","NODE_ENV","hmr","production","mainBabelOptions","babelrc","cacheDirectory","presets","resolve","babel","target","devtool","externals","whitelist","cache","performance","hints","resolveLoader","modules","extensions","mainFields","filter","Boolean","aliasFields","entry","index","server","paths","src","output","build","filename","sourceMapFilename","publicPath","libraryTarget","module","rules","test","loader","exclude","loaders","jsLoaders","plugins","DefinePlugin","JSON","stringify","BannerPlugin","raw","banner","NoEmitOnErrorsPlugin","HotModuleReplacementPlugin","NamedModulesPlugin"],"mappings":";;;;;;;;AAAA;AACA,MAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,MAAMC,UAAUD,QAAQ,SAAR,CAAhB;AACA,MAAME,gBAAgBF,QAAQ,wBAAR,CAAtB;AACA,MAAMG,SAASH,QAAQ,UAAR,CAAf;;kBAEgBI,OAAD,IAAa;AAC1B,QAAMC,MAAMD,QAAQC,GAAR,IAAeC,QAAQD,GAAR,CAAYE,QAAvC;AACA,QAAMC,MAAMJ,QAAQI,GAApB;AACA,QAAMC,aAAaJ,QAAQ,YAA3B;;AAEA,QAAMK;AACJC,aAAS,KADL;AAEJC,oBAAgBJ,GAFZ;AAGJK,aAAS,CACPb,QAAQc,OAAR,CAAgB,SAAhB,CADO;AAHL,KAMDV,QAAQW,KANP,CAAN;;AASA,SAAO;AACL;AACAC,YAAQ,MAFH;AAGL;AACAC,aAAS,YAJJ;AAKL;AACAC,eAAWhB,cAAc;AACvBiB;AADuB,KAAd,CANN;AASL;AACAC,WAAOZ,GAVF;AAWL;AACAa,iBAAa;AACXC,aAAO;AADI,KAZR;AAeLC,mBAAe;AACbC;AADa,KAfV;AAkBLV,aAAS;AACPU,+BADO;AAEPC,iCAFO;AAGPC,kBAAY,CACV,CAACjB,UAAD,IAAe,kBADL,EAEV,cAFU,EAGV,CAACA,UAAD,IAAe,UAHL,EAIV,MAJU,EAKVkB,MALU,CAKHC,OALG,CAHL;AASPC,mBAAa,CACX,CAACpB,UAAD,IAAe,0BADJ,EAEX,sBAFW,EAGX,SAHW,EAIXkB,MAJW,CAIJC,OAJI;AATN,KAlBJ;AAiCLE,WAAO;AACLC,aAAO,CACLvB,OAAO,kBADF,EAEJ,GAAET,KAAKe,OAAL,CAAaX,OAAO6B,MAAP,CAAcC,KAAd,CAAoBC,GAAjC,CAAsC,WAFpC;AADF,KAjCF;AAuCLC,YAAQ;AACNpC,YAAMA,KAAKe,OAAL,CAAaX,OAAO6B,MAAP,CAAcC,KAAd,CAAoBG,KAAjC,CADA;AAENC,gBAAU,WAFJ;AAGNC,yBAAmB,YAHb;AAINC,kBAAYpC,OAAO6B,MAAP,CAAcO,UAJpB;AAKNC,qBAAe;AALT,KAvCH;;AA+CLC,YAAQ;AACNC,aAAO,CACL;AACEC,cAAM,SADR;AAEEC,gBAAQ;AAFV,OADK,EAKL;AACED,cAAM,aADR;AAEEE,iBAAS,CACP,cADO,EAEP1C,OAAO6B,MAAP,CAAcC,KAAd,CAAoBG,KAFb,CAFX;AAMEU,iBAAS,CACP,EAAEF,QAAQ,cAAV,EAA0BxC,SAASM,gBAAnC,EADO,EAEP,GAAGN,QAAQ2C,SAFJ;AANX,OALK;AADD,KA/CH;;AAmELC,aAAS,CACP,IAAI/C,QAAQgD,YAAZ;AACE,8BAAwBC,KAAKC,SAAL,CAAe9C,GAAf;AAD1B,OAEMI;AAAA;AAAA,UAFN,EADO,EAMP,IAAIR,QAAQmD,YAAZ,CAAyB;AACvBC,WAAK,IADkB;AAEvBC,cAAQ;AAFe,KAAzB,CANO,EAWP,IAAIrD,QAAQsD,oBAAZ,EAXO,EAaP/C,OAAO,IAAIP,QAAQuD,0BAAZ,EAbA,EAcPhD,OAAO,IAAIP,QAAQwD,kBAAZ,EAdA,EAeP9B,MAfO,CAeAC,OAfA;AAnEJ,GAAP;AAoFD,C","file":"createWebpackConfig.js","sourcesContent":["// const fs = require('fs');\nconst path = require('path');\nconst webpack = require('webpack');\nconst nodeExternals = require('webpack-node-externals');\nconst config = require('./config');\n\nexport default (options) => {\n  const env = options.env || process.env.NODE_ENV;\n  const hmr = options.hmr;\n  const production = env === 'production';\n\n  const mainBabelOptions = {\n    babelrc: false,\n    cacheDirectory: hmr,\n    presets: [\n      require.resolve('./babel'),\n    ],\n    ...options.babel,\n  };\n\n  return {\n    // Target node\n    target: 'node',\n    // get right stack traces\n    devtool: 'source-map',\n    // don't bundle node_modules dependencies\n    externals: nodeExternals({\n      whitelist: ['pobpack-node/hot'],\n    }),\n    // use cache\n    cache: hmr,\n    // bundle size is not relevant for node\n    performance: {\n      hints: false,\n    },\n    resolveLoader: {\n      modules: ['node_modules'],\n    },\n    resolve: {\n      modules: ['node_modules'],\n      extensions: ['.js', '.jsx'],\n      mainFields: [\n        !production && 'webpack:main-dev',\n        'webpack:main',\n        !production && 'main-dev',\n        'main',\n      ].filter(Boolean),\n      aliasFields: [\n        !production && 'webpack:node-aliases-dev',\n        'webpack:node-aliases',\n        'webpack',\n      ].filter(Boolean),\n    },\n    entry: {\n      index: [\n        hmr && 'pobpack-node/hot',\n        `${path.resolve(config.server.paths.src)}/index.js`,\n      ],\n    },\n    output: {\n      path: path.resolve(config.server.paths.build),\n      filename: '[name].js',\n      sourceMapFilename: '[name].map',\n      publicPath: config.server.publicPath,\n      libraryTarget: 'commonjs2',\n    },\n\n    module: {\n      rules: [\n        {\n          test: /\\.json$/,\n          loader: 'json-loader',\n        },\n        {\n          test: /\\.(js|jsx)$/,\n          exclude: [\n            /node_modules/,\n            config.server.paths.build,\n          ],\n          loaders: [\n            { loader: 'babel-loader', options: mainBabelOptions },\n            ...options.jsLoaders,\n          ],\n        },\n      ],\n    },\n\n    plugins: [\n      new webpack.DefinePlugin({\n        'process.env.NODE_ENV': JSON.stringify(env),\n        ...(production ? { 'module.hot': false } : {}),\n      }),\n\n      new webpack.BannerPlugin({\n        raw: true,\n        banner: 'require(\"pobpack-node/source-map-support\").install();',\n      }),\n\n      new webpack.NoEmitOnErrorsPlugin(),\n\n      hmr && new webpack.HotModuleReplacementPlugin(),\n      hmr && new webpack.NamedModulesPlugin(),\n    ].filter(Boolean),\n  };\n};\n"]}